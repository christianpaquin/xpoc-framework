!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).xpoc={})}(this,(function(t){"use strict";async function e(t,e){const r=await fetch(t).then((t=>t.text())).catch((t=>t));if(r instanceof Error)return r;const a=r,o=(new DOMParser).parseFromString(a,"text/html");if(o.querySelector("parsererror"))return new Error("Failed to parse HTML");o.querySelectorAll("script, img").forEach((t=>{t.parentNode?.removeChild(t)}));const n=[];for(const t of e){const e=o.querySelector(t.nodeQuery)??void 0;n.push(e?.getAttribute(t.attribute)??void 0)}return n}const r="^ACCOUNT^",a="^PUID^",o="^ACCCOUNTTYPE^",n="^CONTENTTYPE^",s="^CONTENTTITLE^";class i{constructor(t,e,r,a,o,n,s,i,c,u){this.Alias=void 0,this.SupportAccountUrls=!0,this.SupportContentUrls=!0,this.removeAtPrefixInAccountNames=!0,this.DisplayName=t,this.CanonicalHostname=e,this.AccountPathUrlTemplate=r,this.ContentPathUrlTemplate=a,this.CanFetchAccountData=o,this.CanFetchContentData=n,this.regexHostnameString=s,this.accountRegexString=s+i,this.contentRegexString=s+c,this.accountXpocUriQuery=u}isValidAccountUrl(t){if(!this.SupportAccountUrls)return!1;return new RegExp(this.accountRegexString).test(t)}isValidContentUrl(t){if(!this.SupportContentUrls)return!1;return new RegExp(this.contentRegexString).test(t)}canonicalizeAccountName(t){return t=t.trim(),this.removeAtPrefixInAccountNames&&(t=t.replace(/^@/,"")),t}canonicalizeAccountUrl(t){if(!this.SupportAccountUrls)throw new Error(`${this.DisplayName} does not support account URLs`);if(!this.isValidAccountUrl(t))throw new Error(`Malformed ${this.DisplayName} account URL`);const e=new RegExp(this.accountRegexString).exec(t);if(e&&e.groups){const t=e.groups.accountName||"",a=e.groups.accountType||"";return{url:this.CanonicalHostname+"/"+this.AccountPathUrlTemplate.replace(r,t).replace(o,a),account:t}}{const t=`Malformed ${this.DisplayName} account URL`;throw console.error(`canonicalizeAccountUrl: ${t}`),new Error(t)}}canonicalizeContentUrl(t){if(!this.SupportContentUrls)throw new Error(`${this.DisplayName} does not support content URLs`);if(!this.isValidContentUrl(t))throw new Error(`Malformed ${this.DisplayName} content URL`);const e=new RegExp(this.contentRegexString).exec(t);if(e&&e.groups){const t=e.groups.accountName||"",o=e.groups.puid||"",i=e.groups.type||"",c=e.groups.title||"";return{account:t,puid:o,type:this.filterType(i),url:this.CanonicalHostname+"/"+this.ContentPathUrlTemplate.replace(a,o).replace(r,t).replace(n,i).replace(s,c)}}{const t=`Malformed ${this.DisplayName} content URL`;throw console.error(`canonicalizeContentUrl: ${t}`),new Error(t)}}filterType(t){return"misc"}async getAccountData(t){if(!this.CanFetchAccountData||!this.accountXpocUriQuery)throw new Error("Not supported");const r=this.canonicalizeAccountUrl(t);try{const t=r.url+(this.accountXpocUriQuery.canonicalUrlSuffix??""),a=(await e(t,[this.accountXpocUriQuery.queryObject]))[0];return{xpocUri:c(a),platform:this.DisplayName,url:r.url,account:r.account}}catch(t){throw new Error(`Failed to fetch ${this.DisplayName} data`)}}async getContentData(t){throw new Error("Not supported")}}const c=t=>{if(!t)throw new Error("Invalid content; can't search for XPOC URI");const e=/xpoc:\/\/([a-zA-Z0-9.-]+)(\/[^!\s<]*)?!?/g.exec(t);if(e)return e[0];throw new Error("Content does not contain a XPOC URI")},u=t=>{if(!t)return"";const e=/(\d{1,2}:\d{2}(:\d{2})?)/.test(t),r=new Date(t).toISOString();return e?r:r.replace(/T.*/,"T00:00:00Z")};class p extends i{constructor(t,e){super(t,e,"","",!1,!1,"","",""),this.SupportAccountUrls=!1,this.SupportContentUrls=!1}}class m extends i{constructor(){super("YouTube","https://www.youtube.com",`@${r}`,`watch?v=${a}`,!0,!0,"^https?://(?:www\\.|m\\.)?(youtube\\.com|youtu\\.be)","/@(?<accountName>[^/]+)(/about)?/?$","/watch\\?(?:[^&]*&)*v=(?<puid>[\\w-]{11})(?:&[^ ]*)?$",{queryObject:{nodeQuery:'meta[name="description"]',attribute:"content"}}),this.filterType=t=>"video"}async getContentData(t){const r=this.canonicalizeContentUrl(t);try{const t=await e(r.url,[{nodeQuery:'span[itemprop="author"] link[itemprop="url"]',attribute:"href"},{nodeQuery:'meta[itemprop="datePublished"]',attribute:"content"},{nodeQuery:'meta[name="description"]',attribute:"content"}]),a=t[0],o=a?.split("/").pop()?.replace("@","")||"",n=t[1],s=t[2];return{xpocUri:c(s),platform:this.DisplayName,url:r.url,account:o,timestamp:u(n),puid:r.puid}}catch(t){throw new Error(`Failed to fetch ${this.DisplayName} data`)}}}class f extends i{constructor(){super("X","https://twitter.com",`${r}`,`${r}/status/${a}`,!1,!1,"^https?://(?:www\\.)?(twitter\\.com|x\\.com)","/@?(?<accountName>[a-zA-Z0-9_]{1,15})$","/@?(?<accountName>[a-zA-Z0-9_]{1,15})/status/(?<puid>\\d{1,19})$"),this.filterType=t=>"post",this.Alias="Twitter"}}class l extends i{constructor(){super("Facebook","https://www.facebook.com",`${r}`,"",!1,!1,"^https?://(?:www\\.|m\\.)?(facebook\\.com|fb\\.com)","/(?<accountName>[^/]+)(/about)?/?$","/(?:(?<accountName>\\w+)/(?:(?<contentType>posts|photos|videos|reels)/)|(?<contentType2>post|photo|video|reel)\\?.*?fbid=(?<fbid>\\d+))"),this.removeAtPrefixInAccountNames=!1}filterType(t){switch(t){case"posts":case"post":return"post";case"photos":case"photo":return"photo";case"videos":case"video":return"video";case"reels":case"reel":return"reel";default:return"misc"}}canonicalizeContentUrl(t){if(!this.isValidContentUrl(t))throw new Error("Malformed Facebook content URL");const e=new RegExp(this.contentRegexString).exec(t);if(e&&e.groups){const r=e.groups.fbid,a=e.groups.contentType||e.groups.contentType2,o=e.groups.accountName,n=new RegExp(this.regexHostnameString+"(?<pathAndParameters>.*)").exec(t);let s=t;return n&&n.groups&&(s=`${this.CanonicalHostname}${n.groups.pathAndParameters}`),{account:o,puid:r,type:this.filterType(a),url:s}}{const t="Malformed Facebook content URL";throw console.error(`canonicalizeContentUrl: ${t}`),new Error(t)}}}class d extends i{constructor(){super("Instagram","https://www.instagram.com",`${r}/`,`${n}/${a}/`,!1,!1,"^https?://(?:www\\.|m\\.)?(instagram\\.com)","/(?<accountName>[^/]+)/?$","/(?<type>p|reel)/(?<puid>[a-zA-Z0-9_-]+)/?(?:\\?.*?)?$")}filterType(t){switch(t){case"p":return"post";case"reel":return"reel";default:return"misc"}}}class h extends i{constructor(){super("Medium","https://medium.com","","",!1,!1,"","",""),this.defaultAccountRegexString="^https?://(?:www\\.)?medium\\.com/@(?<accountName>[^/?]+)(?:/about)?/?(?:\\?.*)?$",this.subdomainFormRegexString="^https?://(?<accountName>[^\\.]+)\\.medium\\.com(?:/about)?/?(?:\\?.*)?$",this.defaultContentRegexString="^https?://(?:www\\.)?medium\\.com/@(?<accountName>[^/]+)/(?<title>[^/]+)-(?<storyID>[a-fA-F0-9]+)/?(?:\\?.*)?$",this.subdomainContentRegexString="^https?://(?<accountName>[^\\.]+)\\.medium\\.com/(?<title>[^/]+)-(?<storyID>[a-fA-F0-9]+)/?(?:\\?.*)?$",this.shortContentRegexString="^https?://(?:www\\.)?medium\\.com/p/(?<storyID>[a-fA-F0-9]+)/?(?:\\?.*)?$"}isValidAccountUrl(t){let e=new RegExp(this.defaultAccountRegexString);return!!e.test(t)||(e=new RegExp(this.subdomainFormRegexString),!!e.test(t))}isValidContentUrl(t){let e=new RegExp(this.defaultContentRegexString);return!!e.test(t)||(e=new RegExp(this.subdomainContentRegexString),!!e.test(t)||(e=new RegExp(this.shortContentRegexString),!!e.test(t)))}canonicalizeAccountUrl(t){if(!this.isValidAccountUrl(t))throw new Error("Malformed Medium account URL");let e=new RegExp(this.defaultAccountRegexString),r=e.exec(t);if(r&&r.groups&&r.groups.accountName)return{url:`${this.CanonicalHostname}/@${r.groups.accountName}`,account:r.groups.accountName};if(e=new RegExp(this.subdomainFormRegexString),r=e.exec(t),r&&r.groups&&r.groups.accountName)return{url:`https://${r.groups.accountName}.medium.com`,account:r.groups.accountName};const a="Malformed Medium account URL: can't extract account name";throw console.error(`canonicalizeAccountUrl: ${a}`),new Error(a)}canonicalizeContentUrl(t){if(!this.isValidContentUrl(t))throw new Error("Malformed Medium content URL");let e=new RegExp(this.defaultContentRegexString),r=e.exec(t);if(r&&r.groups&&r.groups.storyID&&r.groups.title&&r.groups.accountName)return{account:r.groups.accountName,puid:r.groups.storyID,type:"post",url:`${this.CanonicalHostname}/@${r.groups.accountName}/${r.groups.title}-${r.groups.storyID}`};if(e=new RegExp(this.subdomainContentRegexString),r=e.exec(t),r&&r.groups&&r.groups.storyID&&r.groups.title&&r.groups.accountName)return{account:r.groups.accountName,puid:r.groups.storyID,type:"post",url:`https://${r.groups.accountName}.medium.com/${r.groups.title}-${r.groups.storyID}`};if(e=new RegExp(this.shortContentRegexString),r=e.exec(t),r&&r.groups&&r.groups.storyID)return{account:"",puid:r.groups.storyID,type:"post",url:`${this.CanonicalHostname}/p/${r.groups.storyID}`};const a="Malformed Medium content URL";throw console.error(`canonicalizeContentUrl: ${a}`),new Error(a)}}class g extends i{constructor(){super("TikTok","https://www.tiktok.com",`@${r}`,`@${r}/video/${a}`,!1,!1,"^https?://(?:www\\.)?(tiktok\\.com)","/@(?<accountName>[a-zA-Z0-9\\._]{1,24})/?(?:\\?.*)?$","/@?(?<accountName>[a-zA-Z0-9_]{1,15})/video/(?<puid>\\d{1,19})/?(?:\\?.*)?$"),this.filterType=t=>"video"}}class y extends i{constructor(){super("LinkedIn","https://www.linkedin.com",`${o}/${r}/`,`${n}/${s}/`,!1,!1,"^https?://(?:[a-zA-Z0-9-]+\\.)?(linkedin\\.com)","/(?<accountType>in|company|school)/(?<accountName>[^/]+)(?:/about)?/?(?:\\?.*)?$","/(?!in/|school/|company/)(?<type>[a-zA-Z0-9-]+)/(?<title>[a-zA-Z0-9-_]+)?/?(?:/|\\?.*)?$"),this.removeAtPrefixInAccountNames=!1}filterType(t){switch(t){case"posts":return"post";case"events":return"event";default:return"misc"}}}class w extends i{constructor(){super("Threads","https://www.threads.net",`@${r}`,`@${r}/post/${a}`,!1,!1,"^https?://(?:www\\.)?threads\\.net","/@?(?<accountName>[^/]{1,30})/?(?:\\?.*)?$","/@?(?<accountName>[^/]{1,30})/post/(?<puid>[a-zA-Z0-9-_]+)/?(?:\\?.*)?$"),this.filterType=t=>"post"}}class $ extends i{constructor(){super("Google Scholar","https://scholar.google.com",`citations?user=${r}`,"",!1,!1,"^https?://scholar\\.google\\.com","/citations\\?(?:[^&]*&)*user=(?<accountName>[a-zA-Z0-9-_]+)(?:&[^ ]*)?$",""),this.SupportContentUrls=!1,this.removeAtPrefixInAccountNames=!1}}class b extends i{constructor(){super("Rumble","https://rumble.com",`c/${r}`,`${a}.html`,!0,!0,"^https?://(?:www\\.)?(rumble\\.com)","/(c/)?(?<accountName>(c-\\d{7}|(?<!c-)\\w+))(?:/about)?/?$","/(?<puid>[a-zA-Z0-9-_]+)(\\.html)?/?$",{canonicalUrlSuffix:"/about",queryObject:{nodeQuery:"div.channel-about-description-socials"}}),this.canonicalizeAccountName=t=>t.trim().replace(/^@/,"").replace(/\/?(c\/)?/,""),this.filterType=t=>"video"}async getContentData(t){const r=this.canonicalizeContentUrl(t);try{const t=await e(r.url,[{nodeQuery:'meta[property="og:url"]',attribute:"content"},{nodeQuery:"a.media-by--a",attribute:"href"},{nodeQuery:".media-description-info-tag > div",attribute:"title"},{nodeQuery:'meta[property="og:video:tag"]',attribute:"content"}]),a=(t[0],t[1].replace("/c/","")),o=t[2],n=t[3];return{xpocUri:c(n),platform:this.DisplayName,url:r.url,account:a,timestamp:u(o),puid:r.puid}}catch(t){throw new Error(`Failed to fetch ${this.DisplayName} data`)}}}class P extends i{constructor(){super("GitHub","https://github.com",`${r}`,"",!0,!1,"^https?://(?:www\\.)?(github\\.com)","/(?<accountName>[a-zA-Z0-9-_]{1,39})/?(?:\\?.*)?$","",{queryObject:{nodeQuery:'meta[name="description"]',attribute:"content"}}),this.SupportContentUrls=!1,this.removeAtPrefixInAccountNames=!1}}class z extends i{constructor(){super("Telegram","https://t.me",`${r}`,"",!1,!1,"^https?://(?:www\\.|web\\.)?(telegram\\.org|telegram\\.me|t.me|telegram\\.dog)","/(k/|a/|z/)?#?@?(?<accountName>[^/]+)/?(?:\\?.*?)?$",""),this.SupportContentUrls=!1}}class x extends p{constructor(){super("LINE","https://line.me")}}class A extends p{constructor(){super("Snapchat","https://www.snapchat.com/")}}const v=t=>t?.toLowerCase().replace(/\s+/g,""),U={platforms:[new m,new f,new l,new d,new h,new g,new y,new w,new $,new b,new P,new z,new x,new A],isSupportedPlatform(t){const e=v(t);for(const t of U.platforms)if(v(t.DisplayName)===e||v(t.Alias)===e)return!0;return!1},getCanonicalPlatformName(t){const e=v(t);for(const t of U.platforms)if(v(t.DisplayName)===e||v(t.Alias)===e)return t.DisplayName;return t.trim()},getPlatform(t){const e=v(t);for(const t of U.platforms)if(v(t.DisplayName)===e||v(t.Alias)===e)return t;throw new Error(`Unsupported platform: ${t}`)},isSupportedAccountUrl(t){for(const e of U.platforms)if(e.isValidAccountUrl(t))return!0;return!1},canFetchAccountFromUrl(t){for(const e of U.platforms)if(e.isValidAccountUrl(t)&&e.CanFetchAccountData)return!0;return!1},async getAccountFromUrl(t){for(const e of U.platforms)if(e.isValidAccountUrl(t))return await e.getAccountData(t);throw new Error(`Unsupported platform: ${t}`)},isSupportedContentUrl(t){for(const e of U.platforms)if(e.isValidContentUrl(t))return!0;return!1},canFetchContentFromUrl(t){for(const e of U.platforms)if(e.isValidContentUrl(t)&&e.CanFetchContentData)return!0;return!1},async getContentFromUrl(t){for(const e of U.platforms)if(e.isValidContentUrl(t))return await e.getContentData(t);throw new Error(`Unsupported platform: ${t}`)}};function N(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var C={};!function(t){function e(t,e){return{validate:t,compare:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatNames=t.fastFormats=t.fullFormats=void 0,t.fullFormats={date:e(o,n),time:e(i,c),"date-time":e((function(t){const e=t.split(u);return 2===e.length&&o(e[0])&&i(e[1],!0)}),p),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:function(t){return m.test(t)&&f.test(t)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:function(t){if(y.test(t))return!1;try{return new RegExp(t),!0}catch(t){return!1}},uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:function(t){return l.lastIndex=0,l.test(t)},int32:{type:"number",validate:function(t){return Number.isInteger(t)&&t<=h&&t>=d}},int64:{type:"number",validate:function(t){return Number.isInteger(t)}},float:{type:"number",validate:g},double:{type:"number",validate:g},password:!0,binary:!0},t.fastFormats={...t.fullFormats,date:e(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,n),time:e(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,c),"date-time":e(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,p),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},t.formatNames=Object.keys(t.fullFormats);const r=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31];function o(t){const e=r.exec(t);if(!e)return!1;const o=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(2===n&&function(t){return t%4==0&&(t%100!=0||t%400==0)}(o)?29:a[n])}function n(t,e){if(t&&e)return t>e?1:t<e?-1:0}const s=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function i(t,e){const r=s.exec(t);if(!r)return!1;const a=+r[1],o=+r[2],n=+r[3],i=r[5];return(a<=23&&o<=59&&n<=59||23===a&&59===o&&60===n)&&(!e||""!==i)}function c(t,e){if(!t||!e)return;const r=s.exec(t),a=s.exec(e);return r&&a?(t=r[1]+r[2]+r[3]+(r[4]||""))>(e=a[1]+a[2]+a[3]+(a[4]||""))?1:t<e?-1:0:void 0}const u=/t|\s/i;function p(t,e){if(!t||!e)return;const[r,a]=t.split(u),[o,s]=e.split(u),i=n(r,o);return void 0!==i?i||c(a,s):void 0}const m=/\/|:/,f=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;const l=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;const d=-(2**31),h=2**31-1;function g(){return!0}const y=/[^\\]\\Z/}(C);var S=N(C);const{fullFormats:R}=S,k=R["date-time"],E=R.uri,T=new RegExp("^https://","u");function D(t,{instancePath:e="",parentData:r,parentDataProperty:a,rootData:o=t}={}){if(!t||"object"!=typeof t||Array.isArray(t))return D.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let r;if(void 0===t.name&&(r="name")||void 0===t.baseurl&&(r="baseurl")||void 0===t.version&&(r="version"))return D.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"}],!1;if(void 0!==t.name){const r=0;if("string"!=typeof t.name)return D.errors=[{instancePath:e+"/name",schemaPath:"#/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var n=0===r}else n=!0;if(n){if(void 0!==t.baseurl){const r=0;if("string"!=typeof t.baseurl)return D.errors=[{instancePath:e+"/baseurl",schemaPath:"#/properties/baseurl/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;n=0===r}else n=!0;if(n){if(void 0!==t.version){const r=0;if("string"!=typeof t.version)return D.errors=[{instancePath:e+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;n=0===r}else n=!0;if(n){if(void 0!==t.updated){let r=t.updated;const a=0;if("string"!=typeof r)return D.errors=[{instancePath:e+"/updated",schemaPath:"#/properties/updated/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!k.validate(r))return D.errors=[{instancePath:e+"/updated",schemaPath:"#/properties/updated/format",keyword:"format",params:{format:"date-time"},message:'must match format "date-time"'}],!1;n=0===a}else n=!0;if(n){if(void 0!==t.accounts){let r=t.accounts;const a=0;if(!Array.isArray(r))return D.errors=[{instancePath:e+"/accounts",schemaPath:"#/properties/accounts/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{const t=r.length;for(let a=0;a<t;a++){let t=r[a];const o=0;if(!t||"object"!=typeof t||Array.isArray(t))return D.errors=[{instancePath:e+"/accounts/"+a,schemaPath:"#/properties/accounts/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let r;if(void 0===t.account&&(r="account")||void 0===t.platform&&(r="platform"))return D.errors=[{instancePath:e+"/accounts/"+a,schemaPath:"#/properties/accounts/items/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"}],!1;if(void 0!==t.account){const r=0;if("string"!=typeof t.account)return D.errors=[{instancePath:e+"/accounts/"+a+"/account",schemaPath:"#/properties/accounts/items/properties/account/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var s=0===r}else s=!0;if(s){if(void 0!==t.platform){const r=0;if("string"!=typeof t.platform)return D.errors=[{instancePath:e+"/accounts/"+a+"/platform",schemaPath:"#/properties/accounts/items/properties/platform/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;s=0===r}else s=!0;if(s)if(void 0!==t.url){let r=t.url;const o=0;if("string"!=typeof r)return D.errors=[{instancePath:e+"/accounts/"+a+"/url",schemaPath:"#/properties/accounts/items/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!T.test(r))return D.errors=[{instancePath:e+"/accounts/"+a+"/url",schemaPath:"#/properties/accounts/items/properties/url/pattern",keyword:"pattern",params:{pattern:"^https://"},message:'must match pattern "^https://"'}],!1;if(!E(r))return D.errors=[{instancePath:e+"/accounts/"+a+"/url",schemaPath:"#/properties/accounts/items/properties/url/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1;s=0===o}else s=!0}}if(!(0===o))break}}n=0===a}else n=!0;if(n)if(void 0!==t.content){let r=t.content;const a=0;if(!Array.isArray(r))return D.errors=[{instancePath:e+"/content",schemaPath:"#/properties/content/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{const t=r.length;for(let a=0;a<t;a++){let t=r[a];const o=0;if(!t||"object"!=typeof t||Array.isArray(t))return D.errors=[{instancePath:e+"/content/"+a,schemaPath:"#/properties/content/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let r;if(void 0===t.account&&(r="account")||void 0===t.platform&&(r="platform")||void 0===t.url&&(r="url"))return D.errors=[{instancePath:e+"/content/"+a,schemaPath:"#/properties/content/items/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"}],!1;if(void 0!==t.account){const r=0;if("string"!=typeof t.account)return D.errors=[{instancePath:e+"/content/"+a+"/account",schemaPath:"#/properties/content/items/properties/account/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var i=0===r}else i=!0;if(i){if(void 0!==t.platform){const r=0;if("string"!=typeof t.platform)return D.errors=[{instancePath:e+"/content/"+a+"/platform",schemaPath:"#/properties/content/items/properties/platform/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;i=0===r}else i=!0;if(i){if(void 0!==t.url){let r=t.url;const o=0;if("string"!=typeof r)return D.errors=[{instancePath:e+"/content/"+a+"/url",schemaPath:"#/properties/content/items/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!T.test(r))return D.errors=[{instancePath:e+"/content/"+a+"/url",schemaPath:"#/properties/content/items/properties/url/pattern",keyword:"pattern",params:{pattern:"^https://"},message:'must match pattern "^https://"'}],!1;if(!E(r))return D.errors=[{instancePath:e+"/content/"+a+"/url",schemaPath:"#/properties/content/items/properties/url/format",keyword:"format",params:{format:"uri"},message:'must match format "uri"'}],!1;i=0===o}else i=!0;if(i){if(void 0!==t.desc){const r=0;if("string"!=typeof t.desc)return D.errors=[{instancePath:e+"/content/"+a+"/desc",schemaPath:"#/properties/content/items/properties/desc/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;i=0===r}else i=!0;if(i){if(void 0!==t.puid){const r=0;if("string"!=typeof t.puid)return D.errors=[{instancePath:e+"/content/"+a+"/puid",schemaPath:"#/properties/content/items/properties/puid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;i=0===r}else i=!0;if(i)if(void 0!==t.timestamp){let r=t.timestamp;const o=0;if("string"!=typeof r)return D.errors=[{instancePath:e+"/content/"+a+"/timestamp",schemaPath:"#/properties/content/items/properties/timestamp/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!k.validate(r))return D.errors=[{instancePath:e+"/content/"+a+"/timestamp",schemaPath:"#/properties/content/items/properties/timestamp/format",keyword:"format",params:{format:"date-time"},message:'must match format "date-time"'}],!1;i=0===o}else i=!0}}}}}if(!(0===o))break}}n=0===a}else n=!0}}}}}return D.errors=null,!0}const _=(t,e)=>{if(!t||!e)return!1;const r=t=>t.trim().replace(/^(https?:\/\/)/,"").replace(/\/$/,"");return r(t)===r(e)};class I{constructor(t){this.manifest=t}addAccount(t){this.manifest.accounts=this.manifest.accounts??[],this.manifest.accounts.push(t)}addContentItem(t){this.manifest.content=this.manifest.content??[],this.manifest.content.push(t)}matchAccount(t){const e=[];if(t){if(t.account)for(let r of this.manifest.accounts??[]){let a=t.account.trim();if(U.isSupportedPlatform(r.platform)){const e=U.getPlatform(r.platform);e&&(a=e.canonicalizeAccountName(t.account))}r.account===a&&e.push(r)}if(t.platform){const r=U.getCanonicalPlatformName(t.platform),a=this.manifest.accounts?.filter((t=>t.platform===r));e.push(...a??[])}if(t.url){let r=t.url.trim();for(let a of this.manifest.accounts??[]){if(U.isSupportedPlatform(a.platform)){const e=U.getPlatform(a.platform);e&&e.isValidAccountUrl(t.url)&&(r=e.canonicalizeAccountUrl(t.url).url)}_(a.url,r)&&e.push(a)}}}return e}matchContent(t){const e=[];if(t){if(t.account)for(let r of this.manifest.content??[]){let a=t.account.trim();if(U.isSupportedPlatform(r.platform)){const e=U.getPlatform(r.platform);e&&(a=e.canonicalizeAccountName(t.account))}r.account===a&&e.push(r)}if(t.platform){const r=U.getCanonicalPlatformName(t.platform),a=this.manifest.content?.filter((t=>t.platform===r));e.push(...a??[])}if(t.url){let r=t.url.trim();for(let a of this.manifest.content??[]){if(U.isSupportedPlatform(a.platform)){const e=U.getPlatform(a.platform);e&&e.isValidContentUrl(t.url)&&(r=e.canonicalizeContentUrl(t.url).url)}_(a.url,r)&&e.push(a)}}if(t.puid){const r=t.puid.trim(),a=this.manifest.content?.filter((t=>t.puid===r));e.push(...a??[])}}return e}static validate(t){const e=D;if(e(t))return{valid:!0};return{valid:!1,errors:e.errors?.map((t=>`${t.instancePath}: ${t.message}`??""))??[]}}}I.LatestVersion="0.3",t.Facebook=l,t.GitHub=P,t.GoogleScholar=$,t.Instagram=d,t.LINE=x,t.LinkedIn=y,t.Manifest=I,t.Medium=h,t.NoWebPlatform=p,t.Platform=i,t.Platforms=U,t.Rumble=b,t.Snapchat=A,t.Telegram=z,t.Threads=w,t.TikTok=g,t.XTwitter=f,t.YouTube=m}));
//# sourceMappingURL=xpoc.iife.min.js.map
